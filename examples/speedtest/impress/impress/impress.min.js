let $i_={};$i_.deepClone=(e,t={},r,i=[e],a)=>{if(void 0!=e){if(void 0==r){switch(Object.prototype.toString.call(e)){case"[object Map]":r=new Map;break;case"[object Array]":r=[];break;case"[object Set]":r=new Set;break;case"[object Object]":r={};break;default:return e}a=[r]}let s=[],n=[];for(let o=0,l=i.length;o<l;o++){let p=i[o],d=Object.prototype.toString.call(i[o]);for(let h of("[object Object]"===d&&(p=Object.keys(i[o])),p)){let c;"[object Array]"===d?c=h:"[object Map]"===d?[h,c]=h:c="[object Set]"===d?h:i[o][h];let m=void 0==c||"object"!=typeof c&&"function"!=typeof c,v=c;if(!1===m){let u=Object.prototype.toString.call(c);switch(u){case"[object Object]":v={},s.push(c),n.push(v);break;case"[object Array]":v=[],s.push(c),n.push(v);break;case"[object Map]":v=new Map,s.push(c),n.push(v);break;case"[object Set]":v=new Set,s.push(c),n.push(v);break;case"[object File]":v=new File([c],c.name,{type:c.type});break;case"[object Blob]":v=new Blob([c],{type:c.type});break;default:v=void 0}}"[object Array]"===d?a[o].push(v):"[object Map]"===d?a[o].set(h,v):"[object Set]"===d?a[o].add(v):a[o][h]=v}!0===t.freeze&&Object.freeze(r[o])}return 0===s.length?r:$i_.deepClone(e,t,r,s,n)}},$i_.set=(e,t,...r)=>{let i=0,a=r.length-1;for(;void 0!=t&&i<a;)void 0===t[r[i]]&&(t[r[i]]={}),t=t[r[i]],i++;t&&i===a&&(t[r[i]]=e)},$i_.get=(e,...t)=>{let r=0,i=t.length-1;for(;void 0!=e&&r<i;)e=e[t[r]],r++;return e&&r===i?e[t[r]]:void 0},$i_.wait=e=>new Promise(t=>setTimeout(()=>t(),e));let $idebug={},_idebug={},_idebugMap=new Map;_idebug.getValueFromResolvedPath=(e,t)=>t.reduce((e,t)=>e=e instanceof Map||e instanceof Set?e.get(t):e?.[t],e),$idebug.error=(e,t,...r)=>{switch(e){case"setiPropsMaps":throw Error(`iMpress error --- props ${r[0]}="${r[1]}" is declared on ${t.name} but "${r[1]}" cannot be found on parent or super parent`);case"setiEventMaps":throw Error(`iMpress warning --- i-event "${r[0]}" method ${r[1]}() is not declared in "${t?.name}" or parent passthroughs`);case"i-for":throw Error(`iMpress error --- i-for component: ${t._impressInternal.iGuid} - a valid iteratable must be set (Array, Set, Map).`);case"i-if":throw Error(`iMpress error --- i-if component: ${t._impressInternal.iGuid} - does not have a valid reactive condition attribute.`);case"getResolvedDataPathArrayWithResolvedKeys":throw Error(`iMpress error --- "${r[0]}" is referenced on ${t.name} but cannot be found on parent or super parent`);case"getReactiveMapFromBaseMap":throw Error(`iMpress error --- "${r[0]}" is declared on ${t.name} but cannot be found on parent or super parent`)}},$idebug.setStateChangeLog=(e,t,r,i)=>{let a=i.join("."),s=$i_.deepClone(_idebug.getValueFromResolvedPath(r,i));!1===_idebugMap.has(r._impressInternal.iGuid)&&_idebugMap.set(r._impressInternal.iGuid,new Map);let n=_idebugMap.get(r._impressInternal.iGuid);!1===n.has(a)&&n.set(a,new Set);let o=n.get(a);if(o.add({callerGuid:e._impressInternal.iGuid,callerName:e.name,callerPathArray:t.join("."),value:s,timestamp:Date.now()}),o.size>10)for(let l of o){o.delete(l);break}},$idebug.getStateChangeLog=(e,t)=>{let r=t.join("."),i="string"==typeof e?e:e?._impressInternal?.iGuid,a=_idebugMap.get(i);if(void 0!=a)return a.get(r)},$idebug.getStateChangeByGuid=(e,t)=>{t="string"==typeof t?t.match(/[^\[\]\.\{\}]+/g):t.slice();let r=impressComponents.get(e);if(void 0!=r)return r.iGetState(t)},$idebug.setGlobalMethod=(e=!1)=>{e?window.$idebug=$idebug.getStateChangeByGuid:"function"==typeof window.$idebug&&delete window.idebug};let $itemplate={},_itemplate={};_itemplate.setTemplateAttributeMaps=(e,t,r,i)=>{for(let a of e){let[s,n]=a.split("=");if('"'===n[0]&&(n=n.substring(1,n.length-1)),n=n.replaceAll("&quot;",'"'),"i-event"===s){let o=Object.entries(n=JSON.parse(n));!1===i.has(t)&&i.set(t,new Map);let l=i.get(t);for(let p of o){let[d,h]=p;d=d.trim();let c=(h=h.replace("()","").replace("(",",").replace(")","").split(",")).length;for(;c--;)h[c]=h[c].trim();1===h.length&&h.push("$e"),l.has(d)?l.get(d).push(h):l.set(d,[h])}}else{let m=n.substring(1,n.length-1),v={data:void 0};if(!0===r.has(m))r.get(m).targetMap.set(t,s);else{let u=$ireactive.getReactiveMap(v,m,t,s);r.set(m,u)}}}},_itemplate.wrapInSpan=(e,t)=>{let r=$ireactive.newGUID(),i=e.substring(1,e.length-1),a;return!0===t.has(i)?(a=t.get(i)).targetMap.set(r,"TEXT"):(a=$ireactive.getReactiveMap({data:void 0},i,r,"TEXT"),t.set(i,a)),`<span i-data="${r}">${e}</span>`},_itemplate.createDynamicStyle=(e,t)=>{let r=$ireactive.newGUID(),i=e.substring(1,e.length-1),a;return!0===t.has(i)?(a=t.get(i)).targetMap.set(r,"STYLE"):(a=$ireactive.getReactiveMap({data:void 0},i,r,"STYLE"),t.set(i,a)),`/*${r}*//*${r}*/`},$itemplate.iAttributesHtml=function(e,t,r){let i,a=0,s=0;i=e.match(/(<[^>]+)>|[^<]+|-->/g);for(let n=0,o=i.length;n<o;n++){let l=i[n];if("<!--"===l.substring(0,4)?s++:"-->"===l.substring(l.length-3)&&s>0&&s--,!(s>0)){if((a=function(e,t){if("<"===e[0]){let r=e.match(/<[\s/]*[^\s>]+/)?.[0];void 0!=r&&(r=(r=(r=r.replace("/","")).replace("<","")).trim(),!0===impressObjects.has(r)&&("</"===e.substring(0,2)?t--:t++))}return t}(l,a))>0){"/>"===l.substring(l.length-2)&&s--;continue}if("<"===l[0]){if(l.includes("{props")||l.includes("{data")||l.includes("i-event")){let p=l.match(/<[^\s]+/);p=p[0].slice(1);let d=l.match(/[a-z-]+={[^}]+}|[a-z-]+="{[^}]+}"/g);if(void 0!=d&&!impressObjects.get(p)){let h=$ireactive.newGUID(),c=0,m=d.length;for(_itemplate.setTemplateAttributeMaps(d,h,t,r);c<m;)0===c?i[n]=i[n].replace(d[c],`i-attribute="${h}"`):i[n]=i[n].replace(d[c],""),c++}}}else(l.includes("{props")||l.includes("{data"))&&("<style"===i[n-1]?.substring(0,6)?(i[n]=i[n].replace(/[\t\n]/g,"").trim(),i[n]=i[n].replace(/{data[^}]+}|{props[^}]+}/g,e=>_itemplate.createDynamicStyle(e,t))):i[n]=i[n].replace(/{data[^}]+}|{props[^}]+}/g,e=>_itemplate.wrapInSpan(e,t)))}}return e=i.reduce((e,t)=>e+=t)},$itemplate.correctHtml=function(e){if(e){let t=(e=(e=(e=(e=e.replace(/[\r\n]/g," ")).replace(/\>\s+(?=<)/g,">")).replace(/<\s+/g,"<")).trim()).match(/[^\{]+?(?=})/g);if(t)for(let r=0;r<t.length;r++){let i=t[r].trim();e.replace(`{${t[r]}}`,`{${i}}`)}return e}};let impressObjects=new Map,impressComponents=new Map,$ireactive={},_iGuid=1e3;$ireactive.newGUID=function(){return`#${(_iGuid+=5).toString(36)}`},$ireactive.updateAllChildren=(e,t)=>{let r=[new Set([e])],i=new Set,a=0;for(;void 0!=r[a];)r[a].forEach(a=>{if(!0!==a._impressInternal.controlFlags.isSkipRefresh){let s=a._impressInternal.reactiveLookupMaps.get(e);void 0!=s&&s.forEach((e,r)=>{let s=r.split("."),n=!0,o=0;if(t.length<=s.length)for(let l=0;l<t.length;l++){let p;if("?"!==s[l]?p=s[l]:(p=a._impressInternal.keys[o],o++),t[l]!==p){n=!1;break}}else n=!1;!0===n&&e.forEach(e=>{let t=a._impressInternal.reactiveMaps.get(e);if(!1===i.has(t)){let r=t.resolvedPath;if($ireactive.refreshLookupDataMap(a,t),t.resolvedPath!==r){let s=a._impressInternal.reactiveLookupMaps.get(t.resolvedDataOwner),n=s.get(r);n.delete(e),0===n.size&&s.delete(r),$ireactive.setReactiveLookup(a,t.resolvedDataOwner,t.resolvedPath,e)}i.add(t)}let o=$ireactive.getValueFromLookup(t.resolvedDataOwner,t.reactiveSubMap,t.resolvedDataPathArray,a._impressInternal.keys);if("props."===t.name.substring(0,6)){let l="slot."===e.substring(0,5)?a._impressInternal.iParent:a;$ireactive.setDataFromPath(l,t.name.split("."),o)}if("function"==typeof a.iRender)a.iRender(t,!1,o);else{let p="slot."===e.substring(0,5)?a._impressInternal.iNode.host:a._impressInternal.iNode;$ireactive.setReactiveDataToDOM(a,p,t,!1,a._impressInternal.keys)}})}),"function"==typeof a.afterUpdated&&a.afterUpdated(),a._impressInternal.iChildren.size>0&&r.push(a._impressInternal.iChildren)}else delete a._impressInternal.controlFlags.isSkipRefresh}),a++},$ireactive.setReactiveDataToDOM=(e,t,r,i=!1,a)=>{let s=$ireactive.getValueFromLookup(r.resolvedDataOwner,r.reactiveSubMap,r.resolvedDataPathArray,a);r.targetMap.forEach((a,n)=>{if("OBSERVER"===a){let o=e._impressInternal.iObservers.get(r.name);!1===i&&"function"==typeof e[o]&&e[o](s)}else if("TEXT"===a)$ireactive.refreshTextNodes(t,n,s);else if("STYLE"===a){let l=t.querySelector("style"),p=RegExp(`/\\*${n}\\*/.*/\\*${n}\\*/`);l.innerHTML=l.innerHTML.replace(p,`/*${n}*/${s}/*${n}*/`)}else"props"!==a.substring(0,5)&&$ireactive.refreshAttribute(t,n,a,s,i)})},$ireactive.getPropMap=(e,t,r)=>{let i=`props.${"#"===r[1][0]?t.get(r[1]).value:r[1]}`;return e._impressInternal.reactiveMaps.get(i)},$ireactive.getResolvedDataPathArrayWithResolvedKeys=(e,t,r)=>{let i=`props.${"#"===r[1][0]?t.get(r[1]).value:r[1]}`,a=e._impressInternal.reactiveMaps.get(i);if(void 0!=a){let s=[...a.resolvedDataPathArray,...r.slice(2)],n=0;for(let o=0;o<s.length;o++)"?"===s[o]&&(s[o]=e._impressInternal.keys[n],n++);return{resolvedDataPathArray:s,resolvedDataOwner:a.resolvedDataOwner}}$idebug.error("getResolvedDataPathArrayWithResolvedKeys",e,i)},$ireactive.getValueFromLookup=(e,t,r,i)=>{let a=0;return(Array.isArray(r)?r:r.match(/[^\[\]\.\{\}]+/g)).reduce((e,r)=>("?"===r?(e=e instanceof Map?e.get(i[a]):e instanceof Set?i[a]:e?.[i[a]],a++):e=r?.[0]!=="#"?e instanceof Map?e.get(r):e instanceof Set?r:e?.[r]:e instanceof Map||e instanceof Set?e.get(t.get(r)?.value):e?.[t.get(r)?.value],e),e)},$ireactive.getResolvedDataPathArray=(e,t=e)=>{let r=e!=t?[...e.resolvedDataPathArray,...t.dataPathArray.slice(2)]:t.dataPathArray.slice();for(let i=0;i<r.length;i++){let a=r[i];"?"===a?r[i]="?":"#"===a[0]&&(1===i?r[i]=e.reactiveSubMap.get(a).value:r[i]=t.reactiveSubMap.get(a).value)}return r},$ireactive.isComponentHasOwnData=(e,t)=>{if(void 0!=e.resolvedDataOwner){let r=e.resolvedDataPathArray.slice(0,e.resolvedDataPathArray.length-1),i="?"!==e.resolvedDataPathArray[e.resolvedDataPathArray.length-1]?e.resolvedDataPathArray[e.resolvedDataPathArray.length-1]:t[t.length-1],a=$ireactive.getValueFromLookup(e.resolvedDataOwner,void 0,r,t);if(void 0!=a){if(a instanceof Set||a instanceof Map){if(a.has(i))return!0}else if("object"==typeof a&&Object.hasOwn(a,i))return!0}}return!1},$ireactive.refreshLookupDataMap=(e,t)=>{if(t.reactiveSubMap.forEach((r,i)=>{let a=r.dataOwner,s=r.dataPathArray;if("props"===r.dataPathArray[0]){let n=$ireactive.getPropMap(e,t.reactiveSubMaps,r.dataPathArray);s=[...n.dataPathArray,...dataPathArray.slice(2)],a=n.dataOwner}r.value=$ireactive.getValueFromLookup(a,t.reactiveSubMap,s)}),t.reactiveSubMap.size>0){if("props"===t.dataPathArray[0]){let r=$ireactive.getPropMap(t.dataOwner,t.reactiveSubMap,t.dataPathArray),i=$ireactive.getResolvedDataPathArray(r,t);t.resolvedDataOwner=r.resolvedDataOwner,t.resolvedDataPathArray=i}else{let a=$ireactive.getResolvedDataPathArray(t);t.resolvedDataPathArray=a}}t.resolvedPath=t.resolvedDataPathArray.join(".")},$ireactive.setReactiveLookup=(e,t,r,i)=>{if(!1===e._impressInternal.reactiveLookupMaps.has(t)){let a=new Map;e._impressInternal.reactiveLookupMaps.set(t,a),a.set(r,new Set([i]))}else{let s=e._impressInternal.reactiveLookupMaps.get(t);s.has(r)?s.get(r).add(i):s.set(r,new Set([i]))}},$ireactive.setReactiveMap=(e,t,r)=>{!1===e._impressInternal.reactiveMaps.has(t)&&e._impressInternal.reactiveMaps.set(t,r),$ireactive.setReactiveLookup(e,r.resolvedDataOwner,r.resolvedPath,t),r.reactiveSubMap.forEach((t,i)=>{if("props"===t.dataPathArray[0]){let a=$ireactive.getPropMap(e,r.reactiveSubMap,t.dataPathArray);$ireactive.setReactiveLookup(e,a.resolvedDataOwner,a.resolvedPath,r.name)}else $ireactive.setReactiveLookup(e,t.dataOwner,t.dataPath,r.name)})},$ireactive.getReactiveMap=(e,t,r,i="TEXT",a=new Map([[r,i]]))=>{let s=new Map,n=0,o=[],l=!1;for(;n++<t.length;)"["===t[n-1]&&('"'===t[n]||"'"===t[n]?l=!0:o.push(n));let p=e?._impressInternal?.iNode!=void 0?e:void 0;for(let d=o.length-1;d>=0;d--){let h=o[d],c=t.indexOf("]",h),m=t.substring(h,c),v=m.split("."),u=Number(m),g=isFinite(u)?u:$ireactive.newGUID(),f=p,$=v;if("props"===v[0]&&void 0!=p){let I=$ireactive.getPropMap(e,s,v);$=[...I.dataPathArray,...v.slice(2)],f=I.dataOwner}if("data"===v[0]||"props"===v[0]){let y=new REACTIVESUBMAP(m,v,p);y.value=$ireactive.getValueFromLookup(f,s,$),s.set(g,y)}t=`${t.slice(0,h-1)}.${g}${t.slice(c+1)}`}let b="props"===i.substring(0,5)||"EVENTHANDLER"===i||!1===t.includes("[props")&&0!==t.indexOf("props"),M=new REACTIVEMAP(a,t,p,void 0,s,i);if(!0===b){if("props"===M.dataPathArray[0]){let P=$ireactive.getPropMap(e,M.reactiveSubMap,M.dataPathArray);if(void 0!=P){let S=$ireactive.getResolvedDataPathArray(P,M);M.resolvedDataOwner=P.resolvedDataOwner,M.resolvedDataPathArray=S,M.resolvedPath=M.resolvedDataPathArray.join("."),P.reactiveSubMap.forEach((e,t)=>{"data"===e.dataPathArray[0]&&M.reactiveSubMap.set(t,e)})}else M.resolvedDataOwner=void 0}else{let w=$ireactive.getResolvedDataPathArray(M);M.resolvedDataPathArray=w,M.resolvedPath=M.resolvedDataPathArray.join(".")}}return M},$ireactive.cloneReactiveMap=(e,t)=>{let r=new Map;return e.reactiveSubMap.forEach((i,a)=>{let s=new REACTIVESUBMAP(i.dataPath,i.dataPathArray.slice(),t);s.value=$ireactive.getValueFromLookup(s.dataOwner,e.reactiveSubMap,s.dataPathArray),r.set(a,s)}),new REACTIVEMAP(e.targetMap,e.dataPath,t,e.resolvedPath,r,e.name)},$ireactive.getReactiveMapFromBaseMap=(e,t={},r,i=e,a=!1)=>{!0===e._impressInternal.controlFlags.globalState?.has(r)&&(i=e._impressInternal.iRoot);let s=$ireactive.cloneReactiveMap(t,i);s.name=r;let n=!0===a?`slot.${s.name}`:s.name;if(!0===e._impressInternal.reactiveMaps.has(n))s=e._impressInternal.reactiveMaps.get(n),t.targetMap.forEach((e,t)=>{s.targetMap.set(t,e)});else if("props"===s.dataPathArray[0]){let o=$ireactive.getPropMap(i,s.reactiveSubMap,s.dataPathArray);if(void 0!=o){let l=$ireactive.getResolvedDataPathArray(o,s);s.dataOwner=e,s.resolvedDataPathArray=l,s.resolvedPath=l.join("."),s.resolvedDataOwner=o.resolvedDataOwner,o.reactiveSubMap.forEach((e,t)=>{"data"===e.dataPathArray[0]&&s.reactiveSubMap.set(t,e)})}else s.resolvedDataOwner=void 0}let p=!0===i?._impressInternal.controlFlags.isPassThrough;return $ireactive.isComponentHasOwnData(s,e._impressInternal.keys)?s:!0===p?$ireactive.getReactiveMapFromBaseMap(e,t,r,i._impressInternal.iParent,a):void $idebug.error("getReactiveMapFromBaseMap",e,r)},$ireactive.refreshTextNodes=(e,t,r)=>{let i=e.querySelector(`[i-data="${t}"]`);void 0!=i&&(i.textContent=r)},$ireactive.refreshAttribute=(e,t,r,i,a)=>{let s=e.querySelector(`[i-attribute="${t}"]`);void 0!=s&&(!1===a&&"value"===r&&"input"===s.localName?s.value=i:s.setAttribute(r,i))},$ireactive.setDataFromPath=(e,t,r)=>{let i=t.slice(),a=i.pop(),s=$ireactive.getValueFromLookup(e,void 0,i);void 0!=s&&(s[a]=r)},$ireactive.getDataFromPath=(e,t,r)=>$ireactive.getValueFromLookup(e,void 0,t,r),$ireactive.setCustomObserverReactiveMaps=(e,t)=>{let r={data:void 0};void 0!=e&&"object"==typeof e&&e.forEach((e,i)=>{if(!0===t.has(i))t.get(i).targetMap.set($ireactive.newGUID(),"OBSERVER");else{let a=$ireactive.getReactiveMap(r,i,$ireactive.newGUID(),"OBSERVER");t.set(i,a)}})};class REACTIVEMAP{constructor(e,t,r,i,a,s){this.targetMap=e,this.dataPath=t,this.dataPathArray="string"==typeof t?t.split("."):void 0,this.dataOwner=r,this.resolvedDataOwner=r,this.resolvedDataPathArray=this.dataPathArray,this.resolvedPath=i,this.reactiveSubMap=a,this.name="string"==typeof s&&("data"===s.substring(0,4)||"props"===s.substring(0,5))?s:null}}class REACTIVESUBMAP{constructor(e,t,r,i){this.dataPath=e,this.dataPathArray=t,this.dataOwner=r,this.value=i}}let _iRegister=new Map,_impress={};class IMPRESSINTERNAL{constructor(e){this.name=e.name,this._ireactive=new Map,this._ievents=new Map,this.template=e.template,void 0!=this.template&&""!==this.template?(this.template=$itemplate.correctHtml(this.template),this.template=$itemplate.iAttributesHtml(this.template,this._ireactive,this._ievents)):this.template="",this.templateNode=document.createElement("template"),this.templateNode.innerHTML=this.template,$ireactive.setCustomObserverReactiveMaps(e._impressInternal.iObservers,this._ireactive),impressObjects.set(this.name,this),customElements.define(this.name,class extends HTMLElement{constructor(){super()}connectedCallback(){_impress.connectComponent(this)}disconnectedCallback(){_impress.disconnectComponent(this)}})}}export class IMPRESS{constructor(e){if(this.props={},this.data={},this._impressInternal={},void 0!==e){let t=e.localName,r=_impress.findParentComponentByNode(e),i=void 0==r?this:r._impressInternal.iRoot;this._impressInternal={name:t,iGuid:$ireactive.newGUID(),isMounted:!1,iEventAbort:new AbortController,reactiveLookupMaps:new Map,reactiveMaps:new Map,iNode:e,iParent:r,iRoot:i,iChildren:new Set,iSlotReactive:null,iSlotEvents:null,iObservers:new Map,template:void 0,createKey:void 0,keys:[],controlFlags:{}},!0===Array.isArray(r?._impressInternal.keys)&&this._impressInternal.keys.push(...r._impressInternal.keys),void 0!=r?._impressInternal.createKey&&this._impressInternal.keys.push(r._impressInternal.createKey),this._impressInternal?.iParent?.createKey&&(this._impressInternal.controlFlags.isSkipRefresh=!0),this._impressInternal.iNode.setAttribute("i-guid",this._impressInternal.iGuid),impressComponents.set(this._impressInternal.iGuid,this)}}static register(e){let t=new e;if(t instanceof IMPRESS){if(t.name="string"==typeof t.name?t.name.toLowerCase():void 0,void 0==t.name||void 0!=impressObjects.get(t.name))throw Error(`iMpress error --- ${t.name} is invalid --- components must have a name property that is unique`);if(_iRegister.set(t.name,e),Array.isArray(t.mixins)){let r=t.mixins.map(e=>e.observers||new Set);for(let i=t.mixins.length-1;i>=0;i--){let a=t.mixins[i];void 0==t[methodName]&&"function"==typeof a[methodName]&&(e.prototype[methodName]=a[methodName])}for(let s of r)s.forEach(r=>{t.observers.add(r),e.prototype[r]=mixin[r]})}return new IMPRESSINTERNAL(t),!0}throw Error(`iMpress error --- ${name} invalid class --- class must extend an instance of IMPRESS`)}iDefine(e,...t){switch(void 0==this._impressInternal.controlFlags&&(this._impressInternal.controlFlags={}),e){case"superProps":if("string"==typeof t[0])for(let r of(!1===Array.isArray(this._impressInternal.controlFlags[e])&&(this._impressInternal.controlFlags[e]=new Set),t))this._impressInternal.controlFlags[e].add(r);break;case"globalState":if("string"==typeof t[0])for(let i of(!1===Array.isArray(this._impressInternal.controlFlags[e])&&(this._impressInternal.controlFlags[e]=new Set),t))this._impressInternal.controlFlags[e].add(i);break;case"isPassThrough":case"isShadowDOM":this._impressInternal.controlFlags[e]=!0===t[0];break;case"observer":void 0==this._impressInternal.iObservers&&(this._impressInternal.iObservers=new Map),this._impressInternal.iObservers.set(t[0],t[1]);break;case"isDebug":this._impressInternal.iRoot===this&&"boolean"==typeof t[0]&&(this._impressInternal.controlFlags[e]=t[0],$idebug.setGlobalMethod(t[0]))}}iSetState(e,...t){_impress.setState(this,e,t)}iGetState(e){return _impress.getState(this,e)}iDestroy(){this._impressInternal.iNode&&this._impressInternal.iNode.parentNode.removeChild(component._impressInternal.iNode)}iClosest(e){return _impress.iClosest(this,e)}iQuerySelector(e){return _impress.iQuerySelector(this,e)}iQuerySelectorAll(e){return _impress.iQuerySelectorAll(this,e)}iGetComponentByNode(e){return _impress.getComponentByNode(e)}iGetComponentById(e){return _impress.getComponentById(e)}iGetComponentsByName(e){return _impress.getComponentsByName(e)}iWait(){return new Promise(e=>setTimeout(()=>e(),time))}}_impress.connectComponent=e=>{if(!1===e.isConnected)return;let t=e.getAttribute("i-guid");if(void 0==impressComponents.get(t)){let r=_iRegister.get(e.localName)??IMPRESS,i=new r(e);void 0!=i._impressInternal.iParent?(i._impressInternal.iParent._impressInternal.iChildren.add(i),!0===i._impressInternal.iParent._impressInternal.isMounted&&_impress.createComponent(i)):_impress.createComponent(i)}},_impress.createComponent=async e=>{let t=impressObjects.get(e._impressInternal.name);if("function"==typeof e.beforeCreate&&await e.beforeCreate(e),e._impressInternal.iNode.childNodes.length>0){let r=e._impressInternal.iNode.innerHTML;e._impressInternal.iSlotReactive=new Map,e._impressInternal.iSlotEvents=new Map,r=$itemplate.iAttributesHtml(r,e._impressInternal.iSlotReactive,e._impressInternal.iSlotEvents),e._impressInternal.iNode.innerHTML=r}if(!1===e._impressInternal.controlFlags.isShadowDOM)e._impressInternal.iNode.appendChild(t.templateNode.content.cloneNode(!0));else{let i=e._impressInternal.iNode.attachShadow({mode:"open"});i.appendChild(t.templateNode.content.cloneNode(!0)),e._impressInternal.iNode=i}_impress.setiPropsMaps(e),_impress.setiReactiveMaps(e),"i-for"!==e.name&&"i-if"!==e.name&&(_impress.setiEventMaps(e,void 0,e._impressInternal.iSlotEvents),_impress.setiEventMaps(e,void 0,impressObjects.get(e._impressInternal.name)._ievents)),e._impressInternal.iChildren.forEach(e=>{_impress.createComponent(e)}),e._impressInternal.isMounted=!0,"function"==typeof e.afterMounted&&await e.afterMounted(e)},_impress.findParentComponentByNode=function(e){let t=void 0!=e.parentNode.host?e.parentNode.host:e.parentNode,r=t.localName;for(;"body"!==t.localName&&void 0==impressObjects.get(r);)r=(t=void 0!=t.parentNode.host?t.parentNode.host:t.parentNode).localName;return"body"!==r?_impress.getComponentByNode(t):void 0},_impress.disconnectComponent=async e=>{let t=e.getAttribute("i-guid"),r=impressComponents.get(t);if(void 0!=r){if(!0===e.isConnected){let i=r._impressInternal.iParent;"function"==typeof r.afterPortedFrom&&await r.afterPorted(),void 0!=i&&"function"==typeof i.afterPorted&&await i.afterPorted(r);return}0===r._impressInternal.iChildren.size||r._impressInternal.iChildren.forEach(e=>{_impress.destroyComponent(e)}),_impress.destroyComponent(r)}},_impress.destroyComponent=async e=>{if("function"==typeof e.beforeDestroy&&await e.beforeDestroy(e),void 0!=e._impressInternal.iParent&&!0===e._impressInternal.iParent._impressInternal.iChildren.has(e)&&e._impressInternal.iParent._impressInternal.iChildren.delete(e),e._impressInternal.iEventAbort.abort(),"function"==typeof e.afterDestroy&&await e.afterDestroy(e),!0===e._impressInternal.iNode.isConnected){let t=e._impressInternal.iNode;impressComponents.delete(e._impressInternal.iGuid),t.parentNode.removeChild(t)}else impressComponents.delete(e._impressInternal.iGuid)},_impress.setiPropsMaps=e=>{let t=void 0!=e._impressInternal.iNode.host?e._impressInternal.iNode.host:e._impressInternal.iNode;if(void 0!=e._impressInternal.iParent){let r=t.attributes;for(let i of r)if("{data"===i.value.substring(0,5)||"{props"===i.value.substring(0,6)){let a=e._impressInternal.iParent,s=i.value.substring(1,i.value.length-1),n="props."+i.name,o=!0===e._impressInternal.controlFlags.globalState?.has(n)?e._impressInternal.iRoot:a,l;if(void 0!=(l=void 0==a.data.cachedMaps||void 0==a.data.cachedMaps.get(n)?$ireactive.getReactiveMap(o,s,$ireactive.newGUID(),n):a.data.cachedMaps.get(n))){let p=$ireactive.isComponentHasOwnData(l,e._impressInternal.keys);if(!1===p){let d=e._impressInternal.controlFlags.superProps?.has(n),h=a?._impressInternal.controlFlags.isPassThrough??!1;for(;!1===p&&(!0===h||!0===d);)a=a._impressInternal.iParent,l=$ireactive.getReactiveMap(a,s,$ireactive.newGUID(),n),p=$ireactive.isComponentHasOwnData(l,e._impressInternal.keys),h=a?._impressInternal.controlFlags.isPassThrough??!1;!0!==p&&$idebug.error("setiPropsMaps",e,n,s)}$ireactive.setReactiveMap(e,n,l,!1);let c=$ireactive.getValueFromLookup(l.resolvedDataOwner,l.reactiveSubMap,l.resolvedDataPathArray,e._impressInternal.keys);e.props[i.name]=c,"i-for"===e._impressInternal.iParent._impressInternal.name&&e._impressInternal.iParent.data.cachedMaps.set(n,l)}}}},_impress.setiReactiveMaps=e=>{if(void 0!=e._impressInternal.iSlotReactive){let t=void 0!=e._impressInternal.iNode.host,r=!0===t?e._impressInternal.iNode.host:e._impressInternal.iNode;e._impressInternal.iSlotReactive.forEach((i,a)=>{let s=$ireactive.getReactiveMapFromBaseMap(e,i,a,e._impressInternal.iParent,t);if(void 0!=s){let n=!0===t?`slot.${s.name}`:s.name;$ireactive.setReactiveMap(e,n,s),"function"!=typeof e.iRender&&$ireactive.setReactiveDataToDOM(e,r,s,!0,e._impressInternal.keys)}})}impressObjects.get(e._impressInternal.name)._ireactive.forEach((t,r)=>{let i=$ireactive.getReactiveMapFromBaseMap(e,t,r);void 0!=i&&($ireactive.setReactiveMap(e,i.name,i),"i-for"!==e.name&&"i-if"!==e.name&&$ireactive.setReactiveDataToDOM(e,e._impressInternal.iNode,i,!0,e._impressInternal.keys))})},_impress.setiEventMaps=function(e,t,r){void 0!=r&&r.forEach((r,i)=>{let a;a=void 0==t?e._impressInternal.iNode.querySelector(`[i-attribute="${i}"]`):t.querySelector(`[i-attribute="${i}"]`),r.forEach((t,r)=>{for(let i of t){let s=i[0],n=i.slice(1),o=e;for(;void 0!=o&&"function"!=typeof o[s]&&!0===o._impressInternal.controlFlags.isPassThrough;)o=o._impressInternal.iParent;if("function"==typeof o[s]){let l={signal:e._impressInternal.iEventAbort.signal};a.addEventListener(r,e=>{let t=[];for(let r=0,i;void 0!==(i=n[r]);r++){if("$e"===i||"$event"===i)i=e;else if(parseFloat(i)===Number(i))i=parseFloat(i);else if("true"===i||"false"===i)i=Boolean(i);else if("data."===i.substring(0,5)||"props."===i.substring(0,6)){let a=i.match(/[^\[\]\.\{\}]+/g),l=o;if("props"===a[0]){let p=$ireactive.getPropMap(l,void 0,a),d=[...p.resolvedDataPathArray,...a.slice(2)];i=$ireactive.getDataFromPath(p.resolvedDataOwner,d)}else i=$ireactive.getDataFromPath(l,a)}t.push(i)}o[s](...t)},l)}else $idebug.error("setiEventMaps",o,r,s)}})})},_impress.setState=(e,t,r)=>{if("string"==typeof t&&(t=t.match(/[^\[\]\.\{\}]+/g)),"props"===t[0]){let{resolvedDataPathArray:i,resolvedDataOwner:a}=$ireactive.getResolvedDataPathArrayWithResolvedKeys(e,void 0,t);console.log(r[0]),r.length>0&&$ireactive.setDataFromPath(a,i,r[0]),!0===e._impressInternal.iRoot._impressInternal.controlFlags.isDebug&&$idebug.setStateChangeLog(e,t,a,i),$ireactive.updateAllChildren(a,i)}else"data"===t[0]&&(r.length>0&&$ireactive.setDataFromPath(e,t,r[0]),!0===e._impressInternal.iRoot._impressInternal.controlFlags.isDebug&&$idebug.setStateChangeLog(e,t,e,t),$ireactive.updateAllChildren(e,t))},_impress.getState=(e,t)=>{if("props"===(t="string"==typeof t?t.match(/[^\[\]\.\{\}]+/g):t.slice())[0]){let{resolvedDataPathArray:r,resolvedDataOwner:i}=$ireactive.getResolvedDataPathArrayWithResolvedKeys(e,void 0,t),a=$idebug.getStateChangeLog(i,r);return{dataOwner:i._impressInternal.name,dataPath:r,value:$ireactive.getDataFromPath(i,r),stateChangeLog:a}}if("data"===t[0]){let s=$idebug.getStateChangeLog(e,t);return{dataOwner:e._impressInternal.name,dataPath:t,value:$ireactive.getDataFromPath(e,t),stateChangeLog:s}}},_impress.queryObjectMatch=(e,t,r)=>(!1===Object.hasOwn(e,"value")&&!1===Object.hasOwn(e,"notValue")?void 0==t&&(r=void 0):!0===Object.hasOwn(e,"value")?t!==e.value&&(r=void 0):!0===Object.hasOwn(e,"notValue")&&t===e.notValue&&(r=void 0),r),_impress.isQueryMatch=(e,t,r,i,a)=>{let s=e;if(void 0!=t)for(let n=0;n<t.length;n++){let o=$ireactive.getDataFromPath(e,t[n].path);if(void 0==(s=_impress.queryObjectMatch(t[n],o,s)))break}if(void 0!=r)for(let l=0;l<r.length;l++){let p=$ireactive.getDataFromPath(e,r[l].path);if(void 0==(s=_impress.queryObjectMatch(r[l],p,s)))break}if(void 0!=i&&!1===i.includes(e._impressInternal.name)&&(s=void 0),void 0!=a){for(let d=0;d<a.length;d++)if("function"!=typeof e[a[d]]){s=void 0;break}}return s},_impress.iQuerySelector=(e,t)=>{let r=Array.isArray(t.data)||void 0==t.data?t.data:[t.data],i=Array.isArray(t.methods)||void 0==t.methods?t.methods:[t.methods],a=Array.isArray(t.name)||void 0==t.name?t.name:[t.name],s=Array.isArray(t.props)||void 0==t.props?t.props:[t.props],n,o=[e._impressInternal.iChildren];for(let l=0;l<o.length;l++){let p=o[l];for(let d of p){if(void 0!=(n=_impress.isQueryMatch(d,r,i,a,s)))break;d._impressInternal.iChildren.size>0&&o.push(d._impressInternal.iChildren)}if(void 0!=n)break}return n},_impress.iQuerySelectorAll=(e,t)=>{let r=Array.isArray(t.data)||void 0==t.data?t.data:[t.data],i=Array.isArray(t.methods)||void 0==t.methods?t.methods:[t.methods],a=Array.isArray(t.name)||void 0==t.name?t.name:[t.name],s=Array.isArray(t.props)||void 0==t.props?t.props:[t.props],n=[],o=[e._impressInternal.iChildren];for(let l=0;l<o.length;l++){let p=o[l];for(let d of p){let h=_impress.isQueryMatch(d,r,i,a,s);void 0!=h&&n.push(h),d._impressInternal.iChildren.size>0&&o.push(d._impressInternal.iChildren)}}return n},_impress.iClosest=(e,t)=>{let r=Array.isArray(t.data)||void 0==t.data?t.data:[t.data],i=Array.isArray(t.methods)||void 0==t.methods?t.methods:[t.methods],a=Array.isArray(t.name)||void 0==t.name?t.name:[t.name],s=Array.isArray(t.props)||void 0==t.props?t.props:[t.props],n,o=e._impressInternal.iParent;for(;void 0!=o&&void 0==n;)n=_impress.isQueryMatch(o,r,i,a,s),o=o._impressInternal.iParent;return n},_impress.getComponentByNode=e=>{if(void 0!=e){let t=e.getAttribute("i-guid");return impressComponents.get(t)}},_impress.getComponentById=e=>impressComponents.get(e),_impress.getComponentsByName=e=>{let t=[];return impressComponents.forEach((r,i)=>{r._impressInternal.name===e&&t.push(r)}),t};class IFOR extends IMPRESS{#a=void 0;#b=0;#c=new Map;#d=!1;#e;constructor(e){super(e),this.name="i-for",this.template="",this.#e=document.createElement("template"),this.data.cachedMaps=new Map,this.data.iterablePropName=void 0,this._impressInternal.iSlotReactive=new Map,this._impressInternal.iSlotEvents=new Map,this.iDefine("observer","props.of","propsOf"),this.iDefine("isPassThrough",!0),this.iDefine("isShadowDOM",!1)}beforeCreate(){let e=this._impressInternal.iNode.innerHTML,t=this._impressInternal.iNode.getAttribute("let");this.data.iterablePropName=t.trim(),1===this._impressInternal.iNode.children.length&&(this.#d=!0),this._impressInternal.iNode.children.length>0&&(void 0!=e&&""!==e&&(this.template=e,this.template=this.template.replaceAll(`{${this.data.iterablePropName}`,"{props.of.?"),this.template=$itemplate.iAttributesHtml(this.template,this._impressInternal.iSlotReactive,this._impressInternal.iSlotEvents)),this.#e.innerHTML=this.template),this._impressInternal.iNode.innerHTML=""}afterMounted(){try{!0===Array.isArray(this.props.of)?this.#a="Array":this.props.of instanceof Set?this.#a="Set":this.props.of instanceof Map&&(this.#a="Map"),void 0==this.#a&&$idebug.error("i-for",this),this.propsOf(this.props.of)}catch(e){console.error(e),this.iDestroy()}}iRender(e,t=!1,r){e.targetMap.forEach((i,a)=>{if("OBSERVER"===i){if(!1===t){let s=this._impressInternal.iObservers.get(e.name);"function"==typeof this[s]&&this[s](r)}}else"TEXT"===i?this.props.of.forEach((t,r)=>{let i=this.#c.get(r);if(void 0!=i){let s=$ireactive.getValueFromLookup(e.resolvedDataOwner,e.reactiveSubMap,e.resolvedDataPathArray,[...this._impressInternal.keys,r]);if(!0===this.#d)$ireactive.refreshTextNodes(i,a,s);else for(let n=0;n<i.length;n++)$ireactive.refreshTextNodes(i[n],a,s)}}):"props"!==i.substring(0,5)&&this.props.of.forEach((t,r)=>{let s=this.#c.get(r);if(void 0!=s){let n=$ireactive.getValueFromLookup(e.resolvedDataOwner,e.reactiveSubMap,e.resolvedDataPathArray,[...this._impressInternal.keys,r]);if(!0===this.#d)$ireactive.refreshAttribute(s,a,i,n,!1);else for(let o=0;o<s.length;o++)$ireactive.refreshAttribute(s[o],a,i,n,!1)}})})}propsOf(e){let t=Array.isArray(e)?e.length:e.size;if((0===t||void 0==t)&&0===t){this.#c.clear(),this._impressInternal.iChildren.clear(),this._impressInternal.iNode.innerHTML="",this.#b=t;return}if(this.#b!==t){if(this.#b<t){let r=0;e.forEach((e,t)=>{if(r>=this.#b){let i=this.#e.content.cloneNode(!0);if(_impress.setiEventMaps(this,i,this._impressInternal.iSlotEvents),this._impressInternal.reactiveMaps.forEach(e=>{$ireactive.setReactiveDataToDOM(this,i,e,!0,[...this._impressInternal.keys,t])}),!0===this.#d)this.#c.set(t,i.children[0]);else{let a=Array.from(i.childNodes);this.#c.set(t,a)}this._impressInternal.createKey=t,this._impressInternal.iNode.appendChild(i)}r++}),this.#b=t}else this.#c.forEach((t,r)=>{Array.isArray(e)?!1===e.includes(r)&&(t.remove(),this.#c.delete(r)):!1===e.has(r)&&(t.remove(),this.#c.delete(r))}),this.#b=t}}}class IIF extends IMPRESS{#e;constructor(e){super(e),this.name="i-if",this.template="",this.#e=document.createElement("template"),this.iDefine("observer","props.condition","propsCondition"),this.iDefine("isPassThrough",!0),this.iDefine("isShadowDOM",!1)}beforeCreate(){let e=this._impressInternal.iNode.innerHTML,t=this._impressInternal.iNode.getAttribute("condition");void 0!=t&&("{props"===t.substring(0,6)||"{data"===t.substring(0,5))?this._impressInternal.iNode.children.length>0&&(void 0!=e&&""!==e&&(this.template=e,this.template=this.template.replaceAll(`{${this.data.iterablePropName}`,"{props.of.?"),this.template=$itemplate.iAttributesHtml(this.template,this._impressInternal.iSlotReactive,this._impressInternal.iSlotEvents)),this.#e.innerHTML=this.template):$idebug.error("i-if",this),this._impressInternal.iNode.innerHTML=""}afterMounted(){!0===Object.hasOwn(this.props,"condition")?this.propsCondition(this.props.condition):$idebug.error("i-if",this)}iRender(e,t=!1,r){e.targetMap.forEach((i,a)=>{if("OBSERVER"===i&&!1===t){let s=this._impressInternal.iObservers.get(e.name);"function"==typeof this[s]&&this[s](r)}})}propsCondition(e){if(e){let t=this.#e.content.cloneNode(!0);_impress.setiEventMaps(this,t,this._impressInternal.iSlotEvents),this._impressInternal.reactiveMaps.forEach(e=>{$ireactive.setReactiveDataToDOM(this,t,e,!0,this._impressInternal.keys)}),this._impressInternal.iNode.appendChild(t)}else this._impressInternal.iChildren.clear(),this._impressInternal.iNode.innerHTML=""}}IMPRESS.register(IFOR),IMPRESS.register(IIF);export{$i_};